---
import MainNav from './MainNav.astro';
---

<header id="site-header" class="w-full bg-white border-b border-stone-300 sticky top-0 z-50 shadow-sm transform transition-transform duration-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <a href="/" class="flex items-center gap-3">
        <img src="/favicon.svg" alt="Portal Budowlany" class="w-9 h-9 flex-shrink-0" />
        <span id="site-logo-text" class="text-2xl font-bold text-zinc-700 leading-none">Portal<span class="text-orange-500">Budowlany</span></span>
      </a>
      <MainNav />
    </div>
  </div>
  <!-- Global reading progress (minimal, full-width under topbar) -->
  <div class="w-full bg-stone-200">
    <div id="globalProgressBar" class="h-1 bg-orange-500 transition-all duration-150" style="width:0%"></div>
  </div>

  <script>
    // Hide header on scroll down, show on scroll up (simple, performant)
    (function(){
      const header = document.getElementById('site-header');
      if(!header) return;
      let lastY = window.scrollY;
      let ticking = false;
      function onScroll(){
        const current = window.scrollY;
        if (!ticking) {
          window.requestAnimationFrame(() => {
            if (current > lastY && current > 60) {
              // scrolling down
              header.style.transform = 'translateY(-100%)';
            } else {
              // scrolling up
              header.style.transform = 'translateY(0)';
            }
            lastY = current;
            ticking = false;
          });
          ticking = true;
        }
      }
      window.addEventListener('scroll', onScroll, { passive: true });
    })();

    // Global reading progress bar update
    (function(){
      const bar = document.getElementById('globalProgressBar');
      if (!bar) return;
      function update() {
        const docHeight = document.documentElement.scrollHeight - window.innerHeight;
        const percent = docHeight > 0 ? Math.round((window.scrollY / docHeight) * 100) : 0;
        bar.style.width = percent + '%';
      }
      window.addEventListener('scroll', update, { passive: true });
      window.addEventListener('resize', update);
      // initial
      update();
    })();
  </script>
</header>
