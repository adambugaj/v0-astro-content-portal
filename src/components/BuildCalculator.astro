---
---

<section class="py-12 bg-stone-50 rounded-2xl p-6 mb-12 border border-stone-200" id="build-calculator">
  <h2 class="text-2xl font-bold text-zinc-700 mb-6">Interaktywny Kalkulator Budowy (przykładowe widełki)</h2>

  <div class="space-y-6">
    <!-- Inputs & options below the calculator header -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="space-y-4">
        <label class="block text-sm text-zinc-700">Region</label>
        <select id="bc-region" class="w-full rounded-lg p-2 border">
          <option>Warszawa</option>
          <option>Kraków</option>
          <option>Poznań</option>
          <option>Mniejsze miasta</option>
        </select>

        <label class="block text-sm text-zinc-700">Technologia</label>
        <select id="bc-tech" class="w-full rounded-lg p-2 border">
          <option value="murowany">Murowany</option>
          <option value="szkieletowy">Szkieletowy</option>
          <option value="modułowy">Modułowy</option>
        </select>
      </div>

      <div class="space-y-4">
        <label class="block text-sm text-zinc-700">Powierzchnia (m²)</label>
        <input id="bc-area" type="number" value="120" min="35" max="1000" class="w-full rounded-lg p-2 border" />

        <div class="space-y-2">
          <label class="flex items-center gap-3"><input id="bc-garage" type="checkbox" checked /> Dodaj garaż (+45 000 zł)</label>
          <label class="flex items-center gap-3"><input id="bc-basement" type="checkbox" /> Dodaj piwnicę (+90 000 zł)</label>
          <label class="flex items-center gap-3"><input id="bc-oze" type="checkbox" /> Instalacje OZE (+25 000 zł)</label>
        </div>
      </div>
    </div>

    <!-- Result area placed below inputs for clearer vertical flow inside article -->
    <div class="bg-white rounded-xl p-5 border">
      <div class="flex flex-col md:flex-row items-start md:items-baseline justify-between gap-4">
        <div>
          <p class="text-sm text-zinc-500">Koszt za m² (widełki)</p>
          <p id="bc-perm2" class="text-2xl font-bold text-zinc-800">—</p>
        </div>
        <div class="text-right">
          <p class="text-sm text-zinc-500">Szacunkowy koszt całkowity</p>
          <p id="bc-total" class="text-3xl font-extrabold text-orange-600">—</p>
        </div>
      </div>

      <div class="mt-6">
        <p class="text-sm text-zinc-600 mb-2">Orientacyjny rozkład kosztów (przykładowo)</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <table id="bc-stages" class="w-full text-sm border-collapse">
            <thead>
              <tr class="text-left text-xs text-zinc-500">
                <th class="pb-2">Etap</th>
                <th class="pb-2">%</th>
                <th class="pb-2">Min</th>
                <th class="pb-2">Max</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="p-3 bg-orange-50 rounded-lg border border-orange-100">
            <p class="text-sm text-zinc-600">Notatka:</p>
            <p class="text-sm text-zinc-700">Dane to przykładowe widełki. Dla treści premium rozważ dodanie wykresów z Q1–Q3 2026 oraz źródeł zewnętrznych (GUS, branżowe raporty).</p>
          </div>
        </div>

        <div id="bc-chart-wrap" class="mt-6"></div>
      </div>
    </div>
  </div>

    <script type="module">
    // Calculator logic (no frameworks)
    const REGIONS = { 'Warszawa': 1.15, 'Kraków': 1.08, 'Poznań': 1.03, 'Mniejsze miasta': 0.92 };
    const TECH_BASE = { 
      murowany: { min: 5200, max: 8000 },
      szkieletowy: { min: 4600, max: 6800 },
      'modułowy': { min: 4000, max: 6000 }
    };
    const STAGES = [ { key: 'raw', label: 'Roboty konstrukcyjne', pct: 0.35 }, { key: 'dev', label: 'Roboty developerskie', pct: 0.45 }, { key: 'finish', label: 'Wykończenie', pct: 0.20 } ];
    // NOWY KOD (Zwiększone wartości Q1-Q3 2026)
    const QUARTER_DATA = {
    murowany: { 
      Warszawa: [6100, 6400, 6700],
      Kraków: [5800, 6100, 6400],
      Poznań: [5600, 5850, 6100],
      'Mniejsze miasta': [5200, 5450, 5700]
    },
    szkieletowy: { 
      Warszawa: [5500, 5800, 6100],
      Kraków: [5200, 5450, 5700],
      Poznań: [5000, 5250, 5500],
      'Mniejsze miasta': [4600, 4850, 5100]
    },
    'modułowy': { 
      Warszawa: [4800, 5050, 5300],
      Kraków: [4600, 4850, 5100],
      Poznań: [4400, 4650, 4900],
      'Mniejsze miasta': [4000, 4200, 4400]
    }
    };

    const elArea = document.getElementById('bc-area');
    const elRegion = document.getElementById('bc-region');
    const elTech = document.getElementById('bc-tech');
    const elGarage = document.getElementById('bc-garage');
    const elBasement = document.getElementById('bc-basement');
    const elOze = document.getElementById('bc-oze');

    const elPerm2 = document.getElementById('bc-perm2');
    const elTotal = document.getElementById('bc-total');
    const elStages = document.querySelector('#bc-stages tbody');
    const elChartWrap = document.getElementById('bc-chart-wrap');

    function formatNum(n) { return n.toLocaleString('pl-PL') + ' zł'; }

    function render() {
      const area = Number(elArea.value) || 0;
      const region = elRegion.value;
      const tech = elTech.value;
      const mult = REGIONS[region] || 1;
      const base = TECH_BASE[tech] || TECH_BASE.murowany;
      const perM2Min = Math.round(base.min * mult);
      const perM2Max = Math.round(base.max * mult);
      const extra = (elGarage.checked ? 45000 : 0) + (elBasement.checked ? 90000 : 0) + (elOze.checked ? 25000 : 0);
      const totalMin = Math.round(perM2Min * area + extra);
      const totalMax = Math.round(perM2Max * area + extra);

      elPerm2.textContent = `${formatNum(perM2Min)} — ${formatNum(perM2Max)}`;
      elTotal.textContent = `${formatNum(totalMin)} — ${formatNum(totalMax)}`;

      // stages
      elStages.innerHTML = '';
      STAGES.forEach((s, i) => {
        const minV = Math.round(totalMin * s.pct);
        const maxV = Math.round(totalMax * s.pct);
        const tr = document.createElement('tr');
        tr.className = 'border-t';
        tr.innerHTML = `<td class="py-2 text-zinc-700">${s.label}</td><td class="py-2 text-zinc-600">${Math.round(s.pct*100)}%</td><td class="py-2 text-zinc-700">${formatNum(minV)}</td><td class="py-2 text-zinc-700">${formatNum(maxV)}</td>`;
        elStages.appendChild(tr);
      });

      // chart
      const q = QUARTER_DATA[tech] && QUARTER_DATA[tech][region] ? QUARTER_DATA[tech][region] : [0,0,0];
      renderBarChart(q);
    }

    function renderBarChart(values) {
      const width = 360, height = 120;
      const max = Math.max(...values, 1);
      const barWidth = Math.floor(width / values.length) - 16;
      let svg = `<svg viewBox="0 0 ${width} ${height}" width="100%" height="160" class="mt-4">`;
      values.forEach((v,i) => {
        const barH = Math.round((v / max) * (height - 30));
        const x = 16 + i * (barWidth + 16);
        const y = height - barH - 20;
        svg += `<g><rect x="${x}" y="${y}" width="${barWidth}" height="${barH}" rx="6" fill="#fb923c" opacity="0.95" />`;
        svg += `<text x="${x + barWidth/2}" y="${y - 6}" font-size="11" text-anchor="middle" fill="#374151">${v.toLocaleString()} zł</text>`;
        svg += `<text x="${x + barWidth/2}" y="${height - 6}" font-size="12" text-anchor="middle" fill="#6b7280">Q${i+1}</text></g>`;
      });
      svg += `<text x="8" y="12" font-size="12" fill="#6b7280">Średni koszt za m² — Q1–Q3 2026</text></svg>`;
      elChartWrap.innerHTML = svg;
    }

    [elArea, elRegion, elTech, elGarage, elBasement, elOze].forEach(el => el && el.addEventListener('input', render));
    [elGarage, elBasement, elOze].forEach(el => el && el.addEventListener('change', render));
    render();
  </script>
</section>
