---
const { editors = [] } = Astro.props;

const defaultEditors = [
  {
    name: 'Dariusz Nowicki',
    title: 'Redaktor Naczelny',
    href: '/o-redakcji#dariusz-nowicki'
  },
  {
    name: 'Monika Zielińska',
    title: 'Zastępca Redaktora',
    href: '/o-redakcji#monika-zielinska'
  }
];

const relatedArticles = {
    budowa: [
    { title: 'Etapy budowy', href: '/budowa/etapy-budowy/' },
    { title: 'System gospodarczy budowy', href: '/budowa/koszt-budowy-domu/koszt-system-gospodarczy' },
    { title: 'Koszt budowy 100m²', href: '/budowa/koszt-budowy-domu/koszt-100m2' },
    { title: 'Koszt fundamentów', href: '/budowa/koszt-budowy-domu/koszt-fundamentow' }
  ],
  energia: [
    { title: 'Instalacja fotowoltaiczna', href: '/energia/fotowoltaika' },
    { title: 'Pomp ciepła - jak działają', href: '/energia/pompy-ciepla' },
    { title: 'Kolektory słoneczne', href: '/energia/kolektory-sloneczne' }
  ],
  wnetrza: [
    { title: 'Nowe trendy w aranżacji', href: '/wnetrza/trendy-2026' },
    { title: 'Kolory tego sezonu', href: '/wnetrza/kolory' },
    { title: 'Meble ergonomiczne', href: '/wnetrza/meble' }
  ],
  ogrod: [
    { title: 'Rośliny do ogrodu', href: '/ogrod/rosliny' },
    { title: 'Automatyczne podlewanie', href: '/ogrod/podlewanie' },
    { title: 'Oświetlenie ogrodu', href: '/ogrod/oswietlenie' }
  ]
};

// Detect category from URL
const currentPath = Astro.url.pathname;
const category = currentPath.split('/')[1];
const articles = relatedArticles[category] || relatedArticles.budowa;

const displayEditors = editors.length > 0 ? editors : defaultEditors;
---

<aside class="space-y-6">
  <!-- Table of Contents -->
  <div class="bg-white border border-stone-300 rounded-xl p-6 sticky top-20">
    <h3 class="text-lg font-bold text-zinc-700 mb-4">Spis treści</h3>
    <nav id="toc-nav" class="space-y-2 text-sm">
      <!-- JavaScript will populate this -->
    </nav>
  </div>

  <!-- Related Articles -->
  <div class="bg-stone-50 border border-stone-300 rounded-xl p-6">
    <h3 class="text-lg font-bold text-zinc-700 mb-4">Powiązane artykuły</h3>
    <div class="space-y-3">
      {articles.map((article) => (
        <a href={article.href} class="block text-sm text-zinc-700 hover:text-orange-500 font-medium transition-colors">
          → {article.title}
        </a>
      ))}
    </div>
  </div>

  <!-- Editors Section (Minimalist) -->
  <div class="bg-white border border-stone-300 rounded-xl p-6">
    <h3 class="text-lg font-bold text-zinc-700 mb-4 border-b border-stone-300 pb-3">Autorzy</h3>
    <div class="space-y-3">
      {displayEditors.map((editor) => (
        <a href={editor.href} class="flex items-center gap-3 hover:opacity-75 transition-opacity">
          {editor.name === 'Dariusz Nowicki' && (
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-zinc-600 to-zinc-800 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">
              DN
            </div>
          )}
          {editor.name === 'Monika Zielińska' && (
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white text-xs font-bold flex-shrink-0">
              MZ
            </div>
          )}
          <div class="min-w-0">
            <p class="text-sm font-bold text-zinc-700">{editor.name}</p>
            <p class="text-xs text-zinc-500">{editor.title}</p>
          </div>
        </a>
      ))}
    </div>
    <a href="/o-redakcji" class="block text-center text-xs text-orange-500 hover:text-orange-600 font-semibold mt-4 pt-3 border-t border-stone-300">
      Poznaj całą redakcję →
    </a>
  </div>
</aside>

<script>
  // Generate Table of Contents from article headings
  document.addEventListener('DOMContentLoaded', () => {
    const article = document.querySelector('article');
    const tocNav = document.getElementById('toc-nav');
    
    if (article && tocNav) {
      const headings = article.querySelectorAll('h2, h3');
      const tocItems: string[] = [];
      
      headings.forEach((heading, index) => {
        const id = heading.id || `heading-${index}`;
        if (!heading.id) heading.id = id;
        
        const level = heading.tagName === 'H2' ? '' : 'ml-3';
        const text = heading.textContent || '';
        
        tocItems.push(`
          <a href="#${id}" class="block py-1 text-zinc-600 hover:text-orange-500 transition-colors ${level}">
            ${text}
          </a>
        `);
      });
      
      tocNav.innerHTML = tocItems.join('');
    }
  });
</script>
