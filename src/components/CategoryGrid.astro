---
const categories = [
  {
    title: 'Budowa',
    heading: 'Budowa domu â€“ koszty, technologie i etapy',
    description: 'Kompleksowe poradniki dotyczÄ…ce budowy domu â€“ od kosztÃ³w budowy domu, przez technologie budowlane, aÅ¼ po materiaÅ‚y i formalnoÅ›ci. SprawdÅº realne ceny, kalkulatory kosztÃ³w i checklisty budowlane.',
    href: '/budowa',
    icon: 'ðŸ—ï¸',
    deepLinks: [
      { label: 'Koszt budowy domu', href: '/budowa/koszt-budowy-domu/' },
      { label: 'Technologie budowy', href: '/budowa/technologie-budowy/' },
      { label: 'FormalnoÅ›ci budowlane', href: '/budowa/formalnosci-budowlane/' },
      { label: 'MateriaÅ‚y budowlane', href: '/budowa/materialy-budowlane/' }
    ],
    seoCluster: [
      'Koszt budowy domu 100 mÂ²',
      'Koszt budowy domu systemem gospodarczym',
      'Koszt budowy domu pod klucz',
      'Budowa domu bez pozwolenia'
    ]
  },
  {
    title: 'Dom',
    heading: 'Dom â€“ inspiracje do aranÅ¼acji i instalacji',
    description: 'Nowoczesne rozwiÄ…zania do wykoÅ„czenia domu, systemy instalacyjne i praktyczne porady dotyczÄ…ce wyposaÅ¼enia.',
    href: '/dom',
    icon: 'ðŸ ',
    deepLinks: [
      { label: 'Trendy w wnÄ™trzach', href: '#' },
      { label: 'Instalacje domowe', href: '#' },
      { label: 'Grzewcze systemy', href: '#' }
    ],
    seoCluster: [
      'AranÅ¼acja nowoczesnego domu',
      'Systemy grzewcze',
      'OÅ›wietlenie LED',
      'Izolacja termiczna'
    ]
  },
  {
    title: 'Energia / OZE',
    heading: 'Energia â€“ panele sÅ‚oneczne, pompy ciepÅ‚a i OZE',
    description: 'Kompleksowe informacje o odnawialnych ÅºrÃ³dÅ‚ach energii, fotowoltaice, pompach ciepÅ‚a i nowoczesnych systemach energetycznych.',
    href: '/energia-oze',
    icon: 'âš¡',
    deepLinks: [
      { label: 'Panele sÅ‚oneczne', href: '/energia-oze/' },
      { label: 'Pompy ciepÅ‚a', href: '#' },
      { label: 'Magazynowanie energii', href: '#' }
    ],
    seoCluster: [
      'Instalacja fotowoltaiki',
      'Koszty paneli sÅ‚onecznych',
      'Pompy ciepÅ‚a powietrze-woda',
      'Dotacje na OZE 2026'
    ]
  },
  {
    title: 'OgrÃ³d',
    heading: 'OgrÃ³d â€“ projektowanie, roÅ›liny i pielÄ™gnacja',
    description: 'Porady dotyczÄ…ce projektowania ogrodu, wyboru roÅ›lin i regularnej pielÄ™gnacji przestrzeni zielonej.',
    href: '/ogrod',
    icon: 'ðŸŒ¿',
    deepLinks: [
      { label: 'Projektowanie ogrodu', href: '/ogrod/ogrod-japonski' },
      { label: 'PielÄ™gnacja trawnika', href: '/ogrod/przygotowanie-wiosna' },
      { label: 'RoÅ›liny sezonowe', href: '#' }
    ],
    seoCluster: [
      'OgrÃ³d nowoczesny',
      'PielÄ™gnacja ogrodu',
      'RoÅ›liny wieczne',
      'Nawadnianie ogrodÃ³w'
    ]
  }
];
// Generate dynamic links per category (server-side)
async function loadLinksFor(href) {
  try {
    const folder = href.replace(/^\//, '').replace(/\/$/, '');
    if (!folder) return [];
    const pattern = `/src/pages/${folder}/**/*.astro`;
    const pages = await Astro.glob(pattern);
    const links = [];
    for (const p of pages) {
      if (/index\.astro$/i.test(p.file)) continue;
      const hrefOut = (p.file.replace(/.*[\\\/]src[\\\/]pages/, '')).replace(/index\.astro$/i, '').replace(/\.astro$/i, '') || `/${folder}`;
      let title = p.frontmatter?.title || p.file.split(/[\\\/]/).pop().replace(/\.astro$/i,'').replace(/-/g,' ');
      try {
        let fp = p.file.replace(/\\/g, '/');
        if (!fp.startsWith('/')) fp = '/' + fp;
        const mod = await import('file://' + fp);
        const crumbs = mod?.breadcrumbs;
        if (Array.isArray(crumbs) && crumbs[3] && crumbs[3].label) title = crumbs[3].label;
      } catch (e) {
        // ignore
      }
      links.push({ title, href: hrefOut });
      if (links.length >= 4) break;
    }
    return links;
  } catch (err) {
    return [];
  }
}

// Preload autoLinks for categories
for (const cat of categories) {
  // only for local site categories (href starting with /)
  cat.autoLinks = await loadLinksFor(cat.href);
}

import { scenariosTitle } from '../data/koszt-budowy-domu-breadcrumbs.js';
---

<div class="space-y-12">
  {categories.map((category) => (
    <div class="border-l-4 border-orange-500 pl-6">
      <!-- Main Category Card -->
      <a 
        href={category.href}
        class="group block mb-6"
      >
        <div class="text-4xl mb-3">{category.icon}</div>
        <!-- Changed from h3 title to h2 heading with extended description -->
        <h2 class="text-2xl font-bold text-zinc-700 mb-3 group-hover:text-orange-500 transition-colors">
          {category.heading}
        </h2>
        <p class="text-zinc-600 mb-4 leading-relaxed">
          {category.description}
        </p>
      </a>

      <!-- Added deep links section for internal linking -->
      <div class="mb-6">
        <p class="text-xs font-bold text-zinc-600 mb-3 uppercase">Podlinkowane tematy:</p>
        <div class="flex flex-wrap gap-2">
          {category.deepLinks.map((link) => (
            <a 
              href={link.href}
              class="text-sm text-orange-500 hover:text-orange-600 hover:underline transition-colors"
            >
              {link.label}
            </a>
          ))}
        </div>
      </div>

      <!-- Auto-generated internal links (fallback to seoCluster) -->
      <div class="bg-stone-100 rounded-lg p-4">
        <p class="text-xs font-bold text-zinc-600 mb-3 uppercase">NajczÄ™Å›ciej wyszukiwane:</p>
        <ul class="space-y-2">
          {category.autoLinks && category.autoLinks.length > 0 ? (
            category.autoLinks.map(link => (
              <li>
                <a href={link.href} class="text-sm text-zinc-600 hover:text-orange-500 hover:underline">â†’ {link.title}</a>
              </li>
            ))
          ) : (
            category.seoCluster.map((term) => (
              <li>
                <span class="text-sm text-zinc-600">â†’ {term}</span>
              </li>
            ))
          )}
        </ul>
      </div>
    </div>
  ))}
</div>
